{
  "EPL_PRE_PROCESSING_SYSTEM_CORE_FLOW": {
    "流程概述": "EPL預處理系統依賴圖 - 增強三步架構視覺化流程",
    "版本": "2.1.0",
    "核心理念": "智能路由 → 去重優化 → 關聯分析 → 質量控制 → 並行監控",

    "🔄 數據流程視覺化": {
      "Step_-1": {
        "層級": "layer_-1_input_validation",
        "名稱": "🔍 Phase1數據接收層",
        "輸入": "List[SignalCandidate] from unified_signal_candidate_pool",
        "處理": "⏰ 數據完整性驗證 + 📊 Phase1質量指標檢查 + 🔗 SignalCandidate結構驗證",
        "輸出": "✅ validated_signal_candidates + phase1_quality_metrics",
        "時間": "0.5ms",
        "並行度": "單線程（數據驗證）",
        "視覺標記": "🟢 綠燈 → Phase1數據可信 (>90%信任率)",
        "失敗處理": "🔄 重新請求 | 📦 使用快取 | ⚠️ 降級到基礎模式"
      },

      "Step_0": {
        "層級": "layer_0_intelligent_routing",
        "名稱": "🚦 智能路由決策層",
        "輸入": "✅ 已驗證的 SignalCandidate objects",
        "處理": {
          "🔍 微異常快篩": {
            "signal_volatility_jump": "threshold: 0.3",
            "confidence_drop_rate": "threshold: 0.1",
            "market_stress_index": "threshold: 0.7"
          },
          "🎯 動態分流邏輯": {
            "express_conditions": "data_completeness>=0.9 AND signal_clarity>=0.8 AND confidence>=0.75 AND micro_anomaly_score<0.2",
            "standard_conditions": "medium_quality_signals",
            "deep_conditions": "complex_market_conditions_or_quality_concerns"
          },
          "📊 市況適應分配": {
            "stable_market": "Express(40%) Standard(50%) Deep(10%)",
            "high_risk_market": "Express(15%) Standard(65%) Deep(20%)",
            "extreme_market": "Express(5%) Standard(70%) Deep(25%)"
          }
        },
        "輸出": {
          "🟢 express_lane_signals": "高質量快速通道",
          "🔵 standard_lane_signals": "標準處理通道", 
          "🟣 deep_lane_signals": "深度分析通道"
        },
        "時間": "2ms",
        "並行度": "三通道並行準備",
        "視覺標記": "🟡 黃色 → 智能分流決策"
      },

      "Step_1_2_3_PARALLEL": {
        "層級": "並行執行組 (三通道並行處理)",
        "名稱": "⚡ EPL三步並行處理層",
        "並行處理": {
          "🟢 Express_Lane_Processing": {
            "處理時間": "3ms",
            "處理邏輯": "🚀 信任Phase1評估 + 輕量驗證",
            "去重策略": "⚡ 跳過重複檢查 (信任Phase1)",
            "關聯分析": "📈 直接信任market_environment",
            "質量控制": "✅ 快速通過 + 內嵌評分",
            "視覺標記": "🟢 綠色快速通道"
          },
          "🔵 Standard_Lane_Processing": {
            "處理時間": "15ms",
            "處理邏輯": "📊 標準EPL三步完整流程",
            "去重策略": "🔍 來源共識驗證 + 模型多樣性保留",
            "關聯分析": "🔄 選擇性驗證 + Phase1數據復用",
            "質量控制": "⚖️ 平衡驗證 + 延遲觀察追蹤",
            "視覺標記": "🔵 藍色標準通道"
          },
          "🟣 Deep_Lane_Processing": {
            "處理時間": "40ms",
            "處理邏輯": "🔬 完整驗證 + 深度分析",
            "去重策略": "🕵️ 完整相似度檢查 + 複雜去重邏輯",
            "關聯分析": "📊 完整市場環境重新評估",
            "質量控制": "🛡️ 嚴格品質門檻 + 風險評估",
            "視覺標記": "🟣 紫色深度通道"
          }
        },
        "匯聚點": "🔄 三通道結果合併",
        "總時間": "動態調整 (3-40ms depending on lane distribution)",
        "視覺標記": "🌈 彩色並行區塊"
      },

      "Step_1_Detail": {
        "層級": "layer_1_smart_deduplication",
        "名稱": "🔄 智能去重引擎詳情",
        "輸入": "✅ 分道後的 lane_assigned_candidates",
        "處理詳情": {
          "Phase1數據復用": {
            "adaptation_timestamp": "📅 dynamic_params.adaptation_timestamp",
            "signal_id_check": "🔢 Phase1信號ID直接比對",
            "時間重疊檢查": "⏰ 15分鐘時間窗口"
          },
          "來源共識驗證": {
            "source_overlap_score": "🎯 threshold: 0.72",
            "model_diversity_score": "🌟 threshold: 0.8",
            "action_bias_score": "⚖️ threshold: 0.85",
            "保留規則": "🛡️ preserve_if_model_diversity_score > 0.8"
          }
        },
        "優化策略": {
          "express_lane": "⚡ 跳過重複檢查 (高質量Phase1信號)",
          "standard_lane": "🔍 選擇性重複檢查",
          "deep_lane": "🕵️ 完整重複檢查"
        },
        "輸出": "✅ dedup_filtered_candidates + diversity_preserved_signals",
        "時間": "4ms (enhanced from 3ms)",
        "視覺標記": "🔴 紅色 → 去重處理"
      },

      "Step_2_Detail": {
        "層級": "layer_2_context_correlation",
        "名稱": "🔗 情境關聯分析詳情",
        "輸入": "✅ dedup_filtered_candidates",
        "處理詳情": {
          "Phase1市場環境信任": {
            "volatility_score": "📊 直接使用 market_environment.volatility",
            "liquidity_score": "💧 直接使用 market_environment.liquidity",
            "momentum_score": "🚀 直接使用 market_environment.momentum"
          },
          "關聯決策邏輯": {
            "strengthen": "📈 增強現有信號強度",
            "replace": "🔄 替換較弱信號",
            "independent": "🆕 保持獨立信號"
          }
        },
        "優化策略": "🎯 trust_phase1_market_analysis_results",
        "輸出": "✅ correlation_analyzed_candidates + market_context_metadata",
        "時間": "4ms (optimized from 12ms)",
        "視覺標記": "🟠 橙色 → 關聯分析"
      },

      "Step_3_Detail": {
        "層級": "layer_3_lightweight_quality",
        "名稱": "⚖️ 輕量質量控制詳情",
        "輸入": "✅ correlation_analyzed_candidates",
        "處理詳情": {
          "Phase1質量指標信任": {
            "data_completeness": "📊 直接信任Phase1評估",
            "signal_clarity": "🔍 直接信任Phase1評估", 
            "confidence": "💪 直接信任Phase1評估"
          },
          "內嵌評分引擎": {
            "strength_scoring": "💪 30% weight",
            "confidence_scoring": "🎯 25% weight",
            "quality_scoring": "⭐ 20% weight",
            "risk_scoring": "⚠️ 15% weight",
            "timing_scoring": "⏰ 10% weight"
          },
          "延遲觀察強化": {
            "tracking_duration": "📅 5_minutes",
            "performance_metrics": "📈 price_movement_accuracy + signal_effectiveness",
            "升級邏輯": "🔄 auto_upgrade_to_reinforced_candidate"
          }
        },
        "輸出": "🎯 final_epl_ready_candidates + quality_scores + delayed_observation_queue",
        "時間": "6ms (enhanced from 5ms)",
        "視覺標記": "🟦 深藍色 → 質量控制"
      }
    },

    "🔄 並行監控系統視覺化": {
      "監控_1": {
        "層級": "parallel_monitor_1",
        "名稱": "👀 實時數據質量監控",
        "類型": "real_data_signal_quality_engine",
        "監控範圍": [
          "🟢 Express lane信號品質",
          "📊 整體信號質量指標", 
          "⚡ 處理性能指標"
        ],
        "處理時間": "0ms (非阻塞並行)",
        "輸出目標": "📊 monitoring_dashboard",
        "視覺標記": "👁️ 眼睛圖標 → 品質監控"
      },
      "監控_2": {
        "層級": "parallel_monitor_2", 
        "名稱": "📈 系統負載監控",
        "類型": "system_load_monitor",
        "監控指標": {
          "CPU使用率": "⚡ threshold: 85%",
          "隊列長度": "📋 threshold: 1000_signals",
          "記憶體使用": "💾 threshold: 120MB"
        },
        "降階觸發": "🚨 partial_analysis_mode",
        "處理時間": "0ms (非阻塞並行)",
        "輸出目標": "⚖️ system_load_balancer",
        "視覺標記": "📊 儀表板圖標 → 系統監控"
      }
    },

    "⚡ 性能優化策略視覺化": {
      "🚀 智能路由優化": {
        "微異常快篩": "🔍 提前攔截邊緣信號, 節省後續處理時間",
        "動態分流": "📊 根據市況自動調整通道比例",
        "效率提升": "⬆️ Express Lane: 3ms vs 標準15ms (+80%速度)"
      },
      "🧮 Phase1數據復用": {
        "信任策略": "🎯 高信任Phase1質量指標 (>90%)",
        "避免重複計算": "⚡ 直接使用Phase1預處理結果",
        "節省時間": "⬆️ +70% 計算速度提升 (從45ms → 12ms)"
      },
      "🔄 並行處理": {
        "三通道並行": "🌈 Express/Standard/Deep 同時處理",
        "監控並行": "👀 零延遲並行品質監控",
        "效率提升": "⬆️ +40% 整體吞吐量提升"
      },
      "💾 智能降階": {
        "負載觸發": "⚠️ CPU>85% 或 Queue>1000",
        "降階策略": "🔄 partial_analysis_mode",
        "保護機制": "🛡️ 保證核心功能不中斷"
      }
    },

    "🎯 品質評分系統": {
      "數值化評分": {
        "信號強度評分": "💪 signal_strength * 0.3",
        "信心度評分": "🎯 confidence * 0.25", 
        "品質評分": "⭐ data_completeness * signal_clarity * 0.2",
        "風險評分": "⚠️ (1 - risk_score) * 0.15",
        "時機評分": "⏰ timing_accuracy * 0.1"
      },
      "綜合品質": "🏆 weighted_sum([strength, confidence, quality, risk, timing])",
      "通過門檻": {
        "express_lane": "✅ >= 0.85 綜合評分",
        "standard_lane": "✅ >= 0.65 綜合評分", 
        "deep_lane": "✅ >= 0.45 綜合評分"
      }
    },

    "🔄 動態性能監控": {
      "實時監控": {
        "⏱️ 通道計時": "記錄每個通道實際執行時間",
        "🔍 瓶頸檢測": "自動識別慢速通道",
        "💾 記憶體追蹤": "監控EPL處理記憶體使用",
        "📊 通過率": "各通道信號通過率實時監控"
      },
      "自動調整": {
        "分流比例調整": "📊 根據市況自動調整Express/Standard/Deep比例",
        "閾值動態調整": "🎯 根據市場壓力調整品質門檻",
        "緊急模式": "🚨 極端負載時啟動最小處理模式"
      }
    },

    "📊 總體流程時間線": {
      "原始順序": "45ms (data_validation → routing → step1 → step2 → step3)",
      "優化後並行": "12ms (validation:0.5ms → routing:2ms → three_steps_parallel:max(3,15,40)ms → monitoring:0ms)",
      "各通道時間": {
        "🟢 Express通道": "0.5ms + 2ms + 3ms = 5.5ms",
        "🔵 Standard通道": "0.5ms + 2ms + 15ms = 17.5ms",
        "🟣 Deep通道": "0.5ms + 2ms + 40ms = 42.5ms"
      },
      "加權平均": "⬆️ 12ms (基於動態分流比例)",
      "性能提升": "⬆️ +73% 速度提升 (相比傳統45ms)"
    },

    "🎯 輸出標準化": {
      "數據格式": "📊 List[SignalCandidate] with EPL metadata",
      "品質標記": {
        "epl_status": "✅ pass/review/delayed_observation",
        "processing_lane": "🚦 express/standard/deep",
        "quality_confidence": "📊 0.0-1.0 score",
        "source_diversity": "🌟 model_diversity_score"
      },
      "時間戳": "⏰ 統一 ISO datetime + processing_duration",
      "追蹤標記": "🔄 delayed_observation_queue_id (如適用)"
    },

    "🔗 下游整合點": {
      "提供給": [
        "epl_decision_layer",
        "monitoring_dashboard", 
        "alert_notification_system"
      ],
      "格式保證": "✅ 增強的SignalCandidate + EPL處理元數據",
      "品質保證": "🎯 65-85% EPL通過率 + >88% 準確率基線",
      "性能保證": "⚡ <18ms P99延遲 + >99.9% 系統可用性"
    },

    "🚨 系統彈性設計": {
      "降階機制": {
        "觸發條件": "⚠️ CPU>85% 或 Queue>1000 或 Latency>50ms",
        "降階策略": "🔄 跳過Deep Lane → 只處理Express+Standard",
        "緊急模式": "🚨 只保留Express Lane快速通道"
      },
      "容錯處理": {
        "circuit_breaker": "🔌 連續失敗自動斷路保護",
        "graceful_degradation": "⬇️ 逐步降級而非完全失效",
        "default_pass_through": "🚪 極端情況下保證信號流通"
      }
    }
  }
}
