{
  "phase3_execution_policy": {
    "system_metadata": {
      "version": "2.1.0",
      "last_updated": "2025-08-09",
      "description": "Phase3 Execution Policy Layer - 四情境智能決策引擎視覺化流程 (中文說明版)",
      "conflict_resolution_status": "resolved_with_phase1_phase2_integration",
      "language": "繁體中文",
      "purpose": "JSON架構的中文說明與視覺化流程"
    },
    "PHASE3_EXECUTION_POLICY_CORE_FLOW": {
      "流程概述": "Phase3執行決策層 - 四情境智能決策引擎視覺化流程",
      "版本": "2.1.0",
      "核心理念": "智能決策 → 四情境覆蓋 → 風險控制 → 優先分類 → 精準通知",
      "總體流程時間線": {
        "完整EPL處理": "450ms (layer_-1:50ms → layer_0:30ms → [四情境並行]:150ms → layer_2:80ms → layer_3:40ms → layer_4:30ms → layer_5:100ms)",
        "性能目標": "總處理時間 < 800ms (配置限制)",
        "並行效益": {
          "替換決策": "120ms",
          "加倉決策": "100ms", 
          "新倉決策": "150ms",
          "忽略決策": "60ms"
        },
        "關鍵路徑": "數據驗證 → 情境路由 → 並行決策 → 風險驗證 → 優先分類 → 通知分發",
        "效率優化": "並行處理四情境 + 智能路由 + 批量通知"
      },
      "四情境決策邏輯視覺化": {
        "替換決策流程": {
          "信心度差異計算": "new_confidence - current_confidence ≥ 0.15",
          "方向檢查": "new_direction ≠ current_direction (相反方向)",
          "持倉年齡驗證": "position_age ≥ 5_minutes (避免頻繁切換)",
          "市場時機評估": "RSI極端值 + MACD動量 + 布林帶位置",
          "風險轉換評估": "平倉風險 vs 新倉風險 + 滑點估算",
          "最終決策": "加權評分 ≥ 0.75 → 執行替換"
        },
        "加倉決策流程": {
          "信心度提升檢查": "confidence_improvement ≥ 0.08",
          "方向一致驗證": "signal_direction = position_direction",
          "持倉表現要求": "unrealized_pnl > 0 (必須盈利)",
          "風險集中度檢查": "additional_size + current_size ≤ 30% portfolio",
          "波動風險評估": "market_volatility ≤ 6% (控制額外風險)",
          "倉位計算": "confidence_weighted + volatility_adjusted",
          "最終決策": "加權評分 ≥ 0.70 → 執行加倉"
        },
        "新倉決策流程": {
          "持倉狀態檢查": "no_existing_position_for_symbol = true",
          "品質門檻驗證": "embedded_quality_score ≥ 0.8 (80%品質要求)",
          "市場適合度評估": "liquidity ≥ 60% + volatility適中",
          "組合相關性檢查": "portfolio_correlation ≤ 70%",
          "組合容量驗證": "current_positions < 8 (最大持倉數)",
          "凱利公式倉位": "kelly_criterion_modified + 2%風險限制",
          "止損止盈設置": "2xATR止損 + 4xATR止盈 (2:1風險回報)",
          "最終決策": "綜合評分 ≥ 0.70 → 創建新倉"
        },
        "忽略決策流程": {
          "品質檢查": "embedded_quality_score < 0.4 → 品質不足",
          "重複性檢測": "similar_signal_within_15min → 高重複性",
          "市場條件": "low_liquidity OR extreme_volatility → 不利條件",
          "風險超標": "portfolio_risk > daily_budget → 風險過高",
          "學習記錄": "ignore_reason + improvement_suggestion + pattern_data",
          "最終決策": "任一條件滿足 → 忽略信號並記錄學習數據"
        }
      },
      "優先級分類算法視覺化": {
        "評分計算公式": "priority_score = quality×0.3 + urgency×0.25 + confidence×0.25 + risk_reward×0.2",
        "CRITICAL級觸發": {
          "數值條件": "priority_score ≥ 0.85 AND execution_confidence ≥ 0.9",
          "市場條件": "高波動機會 OR 快速趨勢變化",
          "技術條件": "突破關鍵阻力 OR 極端RSI反轉",
          "風險條件": "風險回報比 ≥ 3:1",
          "通知策略": "全通道即時通知 (Gmail+WebSocket+SMS)"
        },
        "HIGH級觸發": {
          "數值條件": "priority_score ≥ 0.75 AND execution_confidence ≥ 0.8",
          "市場條件": "強趨勢確認 OR 突破模式",
          "技術條件": "多重指標確認 OR 成交量突破",
          "風險條件": "風險回報比 ≥ 2:1",
          "通知策略": "主要通道延遲通知 (5分鐘批量)"
        },
        "MEDIUM級觸發": {
          "數值條件": "priority_score ≥ 0.60 AND execution_confidence ≥ 0.65",
          "市場條件": "正常市場條件 OR 中等信號強度",
          "技術條件": "單一指標確認 OR 模式初期",
          "風險條件": "風險回報比 ≥ 1.5:1",
          "通知策略": "標準通道定時通知 (30分鐘批量)"
        },
        "LOW級觸發": {
          "數值條件": "priority_score ≥ 0.40 AND execution_confidence ≥ 0.5",
          "市場條件": "弱信號 OR 研究性機會",
          "技術條件": "指標分歧 OR 不確定模式", 
          "風險條件": "風險回報比 ≥ 1:1",
          "通知策略": "研究通道批量通知 (日終摘要)"
        }
      },
      "系統彈性與容錯設計": {
        "故障轉移機制": {
          "決策引擎失效": "default_to_ignore_with_logging",
          "通知系統失效": "queue_for_retry + 備用通道",
          "風險系統失效": "conservative_default_limits",
          "資料庫失效": "memory_cache_fallback"
        },
        "性能降級策略": {
          "高負載時": "優先處理CRITICAL級決策",
          "資源不足時": "簡化決策邏輯，保證核心功能",
          "網路延遲時": "本地快取決策，後續同步"
        },
        "自我監控": {
          "決策延遲監控": "超過500ms觸發警報",
          "準確率追蹤": "實時追蹤決策成功率",
          "系統健康監控": "CPU/記憶體/連接數監控",
          "異常決策檢測": "異常決策模式自動檢測"
        }
      }
    }
  }
}
