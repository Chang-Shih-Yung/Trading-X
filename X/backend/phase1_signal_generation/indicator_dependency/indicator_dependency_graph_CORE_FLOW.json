{
  "INDICATOR_DEPENDENCY_GRAPH_CORE_FLOW": {
    "流程概述": "技術指標計算依賴圖 - 7層架構視覺化流程",
    "版本": "2.0.0",
    "核心理念": "數據同步 → 基礎計算 → 並行處理 → 復合指標 → 快取優化",

    "🔄 數據流程視覺化": {
      "Step_-1": {
        "層級": "layer_-1_data_sync",
        "名稱": "🔍 數據同步檢查層",
        "輸入": "原始 OHLCV 數據流",
        "處理": "⏰ 時間戳驗證 + 📊 數據完整性檢查 + 🔗 序列連續性驗證",
        "輸出": "✅ synced_OHLCV + data_quality_score",
        "時間": "2ms",
        "並行度": "單線程（數據驗證）",
        "視覺標記": "🟢 綠燈 → 數據可信",
        "失敗處理": "🔄 重新請求 | 📦 使用快取 | ⚠️ 降級模式"
      },

      "Step_0": {
        "層級": "layer_0_raw_data",
        "名稱": "📈 原始價格數據層",
        "輸入": "✅ 已驗證的 synced_OHLCV",
        "處理": "🏷️ 標準化命名格式 {symbol}_{timeframe}_{field}",
        "輸出": "📊 BTCUSDT_1m_open, BTCUSDT_1m_high, BTCUSDT_1m_low, BTCUSDT_1m_close, BTCUSDT_1m_volume",
        "時間": "1ms",
        "並行度": "多時間框架並行",
        "視覺標記": "🔵 藍色 → 原始數據層"
      },

      "Step_1_2_4_PARALLEL": {
        "層級": "並行執行組 (layer_1 + layer_2 + layer_4)",
        "名稱": "⚡ 並行基礎計算層",
        "並行處理": {
          "🧮 Layer_1_Basic": {
            "處理_1": "price_changes = close.diff()",
            "處理_2": "typical_price = (H+L+C)/3",
            "處理_3": "true_range_components",
            "輸出": "💹 價格變化, 典型價格, 真實範圍組件",
            "時間": "5ms"
          },
          "📊 Layer_2_MovingAverages": {
            "處理_1": "🔢 SMA批次計算 [10,20,50]",
            "處理_2": "📈 EMA批次計算 [12,26,50]",
            "處理_3": "📊 Volume_SMA批次計算",
            "輸出": "📈 BTCUSDT_1m_SMA_20, BTCUSDT_1m_EMA_12, BTCUSDT_1m_volume_SMA_20",
            "時間": "15ms",
            "優化": "🚀 向量化批次計算 +60% 速度"
          },
          "📏 Layer_4_RollingExtremes": {
            "處理_1": "📊 highest_high.rolling(14).max()",
            "處理_2": "📊 lowest_low.rolling(14).min()",
            "輸出": "🔺 BTCUSDT_1m_highest_high_14, 🔻 BTCUSDT_1m_lowest_low_14",
            "時間": "8ms"
          }
        },
        "總時間": "15ms (並行執行最慢層)",
        "視覺標記": "🟡 黃色並行區塊"
      },

      "Step_3": {
        "層級": "layer_3_standard_deviations",
        "名稱": "📊 標準差計算層",
        "輸入": "✅ Layer_0 + Layer_2 輸出",
        "處理_1": "📏 price_std_20 = close.rolling(20).std()",
        "處理_2": "📈 return_std_20 = pct_change().rolling(20).std()",
        "輸出": "📊 BTCUSDT_1m_price_std_20, BTCUSDT_1m_return_std_20",
        "時間": "10ms",
        "依賴": "🔗 需要 SMA_20 完成",
        "視覺標記": "🟠 橙色 → 波動性計算"
      },

      "Step_5": {
        "層級": "layer_5_intermediate_calculations",
        "名稱": "🔄 中間計算層",
        "輸入": "✅ Layer_1 + Layer_2 輸出",
        "處理": {
          "RSI組件": "gain = price_changes.where(>0).rolling(14).mean()",
          "MACD線": "macd_line = EMA_12 - EMA_26",
          "真實範圍": "true_range = max(tr1, tr2, tr3)",
          "CCI組件": "typical_price_sma = typical_price.rolling(20).mean()"
        },
        "輸出": "🔄 RSI gain/loss, MACD線, ATR組件, CCI組件",
        "時間": "12ms",
        "視覺標記": "🟣 紫色 → 復合計算準備"
      },

      "Step_6_FINAL": {
        "層級": "layer_6_final_indicators",
        "名稱": "🎯 最終指標計算層",
        "輸入": "✅ 所有前置層輸出",
        "處理": {
          "📈 趨勢指標": {
            "MACD": "✅ macd_line (from layer_5)",
            "MACD_signal": "🔄 MACD.ewm(span=9).mean()",
            "MACD_histogram": "📊 MACD - MACD_signal",
            "trend_strength": "🎯 (price-SMA_20)/SMA_20 + (price-SMA_50)/SMA_50) / 2"
          },
          "⚡ 動量指標": {
            "RSI": "🎯 100 - (100 / (1 + gain/loss))",
            "STOCH_K": "📊 100 * ((close - lowest_low_14) / (highest_high_14 - lowest_low_14))",
            "STOCH_D": "🔄 STOCH_K.rolling(3).mean()",
            "CCI": "🎯 (typical_price - typical_price_sma) / (0.015 * mad)"
          },
          "📊 波動性指標": {
            "BB_upper": "📈 SMA_20 + (price_std_20 * 2)",
            "BB_lower": "📉 SMA_20 - (price_std_20 * 2)",
            "BB_position": "🎯 (price - BB_lower) / (BB_upper - BB_lower)",
            "ATR": "📊 true_range.rolling(14).mean()"
          },
          "📈 成交量指標": {
            "OBV": "🔄 cumsum(sign(price_changes) * volume)",
            "volume_ratio": "📊 current_volume / volume_SMA_20",
            "volume_trend": "📈 (volume_SMA_10 - volume_SMA_50) / volume_SMA_50"
          },
          "🎯 支撐阻力": {
            "pivot_point": "📊 (HH_20 + LL_20 + prev_close) / 3",
            "resistance_1": "📈 2 * pivot_point - LL_20",
            "support_1": "📉 2 * pivot_point - HH_20"
          }
        },
        "輸出格式": "🏷️ {symbol}_{timeframe}_{indicator_name}",
        "例如": "BTCUSDT_1m_RSI, BTCUSDT_1m_MACD, BTCUSDT_1m_BB_position",
        "時間": "20ms",
        "視覺標記": "🔴 紅色 → 最終指標輸出"
      }
    },

    "⚡ 性能優化策略視覺化": {
      "🚀 並行執行": {
        "Group_1": "🟡 [Layer_1 + Layer_2 + Layer_4] 同時執行",
        "節省時間": "從 28ms → 15ms (並行最慢層)",
        "效率提升": "⬆️ +46% 時間節省"
      },
      "🧮 向量化計算": {
        "SMA批次": "🔢 [10,20,50] 一次性計算",
        "EMA批次": "📈 [12,26,50] 向量化處理",
        "節省時間": "⬆️ +60% 計算速度提升"
      },
      "💾 智能快取": {
        "事件驅動": "🔄 新K線 → 立即失效相關快取",
        "自適應TTL": "📊 高波動=10s, 正常=30s, 低波動=60s",
        "命中率目標": "🎯 95%+ 快取命中率"
      }
    },

    "🎯 品質評分系統": {
      "數值化評分": {
        "RSI評分": "🎯 abs(RSI-50)/50, 極值加成 x1.2",
        "MACD評分": "📊 min(1.0, abs(MACD_histogram)/historical_std)",
        "BB評分": "📈 max(abs(BB_position-0.5)*2, squeeze_factor)",
        "成交量確認": "📊 min(1.0, volume_ratio/2.0)"
      },
      "綜合品質": "🏆 weighted_average([RSI:0.25, MACD:0.25, BB:0.25, VOL:0.25])",
      "最低要求": "✅ >= 3個指標, 信心度 >= 0.6"
    },

    "🔄 動態性能監控": {
      "實時監控": {
        "⏱️ 層級計時": "記錄每層實際執行時間",
        "🔍 瓶頸檢測": "自動識別慢速層級",
        "💾 記憶體追蹤": "監控快取使用情況",
        "📊 命中率": "快取性能實時監控"
      },
      "自動降級": {
        "觸發條件": "⚠️ 計算時間 > 100ms",
        "降級策略": "🔄 跳過低優先級指標",
        "緊急模式": "🚨 > 200ms 啟動最小指標集"
      }
    },

    "📊 總體流程時間線": {
      "原始順序": "150ms (layer_-1 → layer_0 → layer_1 → layer_2 → layer_3 → layer_4 → layer_5 → layer_6)",
      "優化後並行": "45ms (layer_-1:2ms → layer_0:1ms → [layer_1+2+4]:15ms → layer_3:10ms → layer_5:12ms → layer_6:20ms)",
      "性能提升": "⬆️ +70% 速度提升 (150ms → 45ms)",
      "並行效益": "⬆️ +25% 額外並行收益"
    },

    "🎯 輸出標準化": {
      "命名規範": "🏷️ {symbol}_{timeframe}_{indicator_name}",
      "例子": [
        "BTCUSDT_1m_RSI",
        "BTCUSDT_5m_MACD_signal",
        "BTCUSDT_15m_BB_position",
        "BTCUSDT_1h_volume_ratio"
      ],
      "品質標記": "📊 每個指標附帶 quality_score (0.0-1.0)",
      "時間戳": "⏰ 統一 ISO datetime 格式"
    },

    "🔗 下游整合點": {
      "提供給": [
        "phase1b_volatility_adaptation_dependency",
        "phase1c_signal_standardization",
        "unified_signal_candidate_pool"
      ],
      "格式保證": "✅ 標準化 {symbol}_{timeframe}_{indicator} 格式",
      "品質保證": "🎯 數值化品質評分 + 數據同步驗證"
    }
  }
}
