<template>
  <div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black">
    <!-- ğŸ¯ çµ±ä¸€ç›£æ§å„€è¡¨æ¿é ‚éƒ¨ -->
    <div class="bg-black/20 backdrop-blur-xl border-b border-white/10 shadow-2xl">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1
              class="text-3xl font-bold text-white bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent">
              ğŸ¯ Trading X çµ±ä¸€ç›£æ§å„€è¡¨æ¿
            </h1>
            <p class="mt-2 text-sm text-gray-300">
              ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹ + Phase 1ABC + Phase 2+3 å®Œæ•´æ•´åˆç›£æ§
            </p>
          </div>
          <div class="flex items-center space-x-6">
            <!-- ç³»çµ±ç¸½é«”ç‹€æ…‹ -->
            <div
              class="flex items-center space-x-3 bg-white/5 backdrop-blur-sm rounded-full px-4 py-2 border border-white/10">
              <div class="relative">
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <div class="absolute inset-0 w-3 h-3 rounded-full animate-ping bg-green-500"></div>
              </div>
              <span class="text-sm font-medium text-green-400">
                ç³»çµ±æ­£å¸¸é‹è¡Œ
              </span>
            </div>
            <!-- æ´»èºæ¨™çš„æ•¸é‡ -->
            <div
              class="text-sm text-gray-300 bg-white/5 backdrop-blur-sm rounded-full px-4 py-2 border border-white/10">
              æ´»èºæ¨™çš„: <span class="font-medium text-cyan-400">{{ sniperLayerStatus.activeSymbols || 0 }}å€‹</span>
            </div>
            <!-- ä¿¡è™Ÿç”Ÿæˆç‡ -->
            <div
              class="text-sm text-gray-300 bg-white/5 backdrop-blur-sm rounded-full px-4 py-2 border border-white/10">
              ä¿¡è™Ÿé€šéç‡: <span class="font-medium text-purple-400">{{ (sniperLayerStatus.passRate * 100).toFixed(1)
                }}%</span>
            </div>
            <!-- æœ€å¾Œæ›´æ–°æ™‚é–“ -->
            <div
              class="text-sm text-gray-300 bg-white/5 backdrop-blur-sm rounded-full px-4 py-2 border border-white/10">
              æ›´æ–°: <span class="font-medium text-white">{{ new Date().toLocaleTimeString() }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <div class="max-w-7xl mx-auto px-6 py-8">

      <!-- ğŸ¯ æ ¸å¿ƒæŒ‡æ¨™å¡ç‰‡å€ -->
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8 mb-8">

        <!-- ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹æ ¸å¿ƒæŒ‡æ¨™ -->
        <div
          class="bg-gradient-to-br from-purple-500/20 to-red-500/20 backdrop-blur-xl text-white rounded-3xl p-8 shadow-2xl border border-purple-400/30"
          style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);">
          <div class="flex items-center justify-between mb-6">
            <div class="p-4 rounded-2xl bg-gradient-to-br from-purple-400/30 to-red-400/30 backdrop-blur-sm">
              <span class="text-3xl">ğŸ¯</span>
            </div>
            <div class="text-right">
              <div class="text-xs text-purple-300 font-medium">SNIPER PROTOCOL</div>
              <div class="text-xl font-bold text-white">{{ sniperLayerStatus.marketRegime || 'ANALYZING' }}</div>
            </div>
          </div>
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">æ´»èºä¿¡è™Ÿ</span>
              <span class="text-2xl font-bold text-white bg-purple-500/20 px-3 py-1 rounded-xl">{{
                sniperLayerStatus.activeSymbols || 0 }}å€‹</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">ç²¾æº–åº¦</span>
              <span
                class="text-xl font-bold text-white bg-gradient-to-r from-purple-500 to-red-500 px-3 py-1 rounded-xl">{{
                  (sniperLayerStatus.passRate * 100).toFixed(1) }}%</span>
            </div>
            <div class="text-xs text-purple-200 mt-3 bg-purple-500/10 px-3 py-2 rounded-lg backdrop-blur-sm">
              é›™å±¤æ¶æ§‹ â€¢ {{ sniperLayerStatus.totalProcessingTime.toFixed(1) }}mså¹³å‡
            </div>
          </div>
        </div>

        <!-- Phase 1ABC æ•´åˆæŒ‡æ¨™ -->
        <div
          class="bg-gradient-to-br from-blue-500/20 to-indigo-600/20 backdrop-blur-xl text-white rounded-3xl p-8 shadow-2xl border border-blue-400/30"
          style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);">
          <div class="flex items-center justify-between mb-6">
            <div class="p-4 rounded-2xl bg-gradient-to-br from-blue-400/30 to-indigo-400/30 backdrop-blur-sm">
              <span class="text-3xl">ğŸ“Š</span>
            </div>
            <div class="text-right">
              <div class="text-xs text-blue-300 font-medium">PHASE 1ABC</div>
              <div class="text-xl font-bold text-white">æ•´åˆéˆ</div>
            </div>
          </div>
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">æ•´åˆè©•åˆ†</span>
              <span class="text-2xl font-bold text-white bg-blue-500/20 px-3 py-1 rounded-xl">85.7%</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">ä¿¡å¿ƒåº¦</span>
              <span
                class="text-xl font-bold text-white bg-gradient-to-r from-blue-500 to-indigo-600 px-3 py-1 rounded-xl">78.5%</span>
            </div>
            <div class="text-xs text-blue-200 mt-3 bg-blue-500/10 px-3 py-2 rounded-lg backdrop-blur-sm">
              ä¿¡è™Ÿé‡æ§‹ â€¢ æ³¢å‹•é©æ‡‰ â€¢ æ¨™æº–åŒ–
            </div>
          </div>
        </div>

        <!-- Phase 2+3 ç¶œåˆåˆ†æ -->
        <div
          class="bg-gradient-to-br from-green-500/20 to-emerald-600/20 backdrop-blur-xl text-white rounded-3xl p-8 shadow-2xl border border-green-400/30"
          style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);">
          <div class="flex items-center justify-between mb-6">
            <div class="p-4 rounded-2xl bg-gradient-to-br from-green-400/30 to-emerald-400/30 backdrop-blur-sm">
              <span class="text-3xl">ğŸ”</span>
            </div>
            <div class="text-right">
              <div class="text-xs text-green-300 font-medium">PHASE 2+3</div>
              <div class="text-xl font-bold text-white">æ·±åº¦åˆ†æ</div>
            </div>
          </div>
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">å‹•æ…‹æ¬Šé‡</span>
              <span class="text-2xl font-bold text-white bg-green-500/20 px-3 py-1 rounded-xl">4æ¬¡</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">é¢¨éšªèª¿æ•´</span>
              <span
                class="text-xl font-bold text-white bg-gradient-to-r from-green-500 to-emerald-600 px-3 py-1 rounded-xl">38.2%</span>
            </div>
            <div class="text-xs text-green-200 mt-3 bg-green-500/10 px-3 py-2 rounded-lg backdrop-blur-sm">
              å¸‚å ´æ·±åº¦ â€¢ å‹•æ…‹é©æ‡‰
            </div>
          </div>
        </div>

        <!-- ç³»çµ±å¥åº·åº¦ç›£æ§ -->
        <div
          class="bg-gradient-to-br from-gray-600/20 to-gray-700/20 backdrop-blur-xl text-white rounded-3xl p-8 shadow-2xl border border-gray-400/30"
          style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);">
          <div class="flex items-center justify-between mb-6">
            <div class="p-4 rounded-2xl bg-gradient-to-br from-gray-400/30 to-gray-500/30 backdrop-blur-sm">
              <span class="text-3xl">âš¡</span>
            </div>
            <div class="text-right">
              <div class="text-xs text-gray-300 font-medium">SYSTEM STATUS</div>
              <div class="text-xl font-bold text-white">æ­£å¸¸é‹è¡Œ</div>
            </div>
          </div>
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">API éŸ¿æ‡‰</span>
              <span class="text-2xl font-bold text-white bg-gray-500/20 px-3 py-1 rounded-xl">{{
                sniperLayerStatus.totalProcessingTime.toFixed(0) }}ms</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-300">æ•¸æ“šå®Œæ•´</span>
              <span
                class="text-xl font-bold text-white bg-gradient-to-r from-gray-500 to-gray-600 px-3 py-1 rounded-xl">100%</span>
            </div>
            <div class="text-xs text-gray-200 mt-3 bg-gray-500/10 px-3 py-2 rounded-lg backdrop-blur-sm">
              å³æ™‚ç›£æ§ â€¢ ç„¡å‡æ•¸æ“š
            </div>
          </div>
        </div>
      </div>

      <!-- ğŸ¯ ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹è©³ç´°ç›£æ§ -->
      <div class="bg-white/5 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/10 mb-8 overflow-hidden"
        style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);">
        <div class="px-8 py-6 border-b border-white/10">
          <div class="flex items-center justify-between">
            <h2
              class="text-xl font-bold text-white bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
              ğŸ¯ ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹ç›£æ§</h2>
            <button @click="refreshSniperLayer" :disabled="loading"
              class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 disabled:from-gray-500 disabled:to-gray-600 text-white text-sm font-bold rounded-2xl transition-all duration-300 shadow-lg backdrop-blur-sm">
              {{ loading ? 'æ›´æ–°ä¸­...' : 'åˆ·æ–°æ•¸æ“š' }}
            </button>
          </div>
        </div>
        <div class="p-8">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">

            <!-- ç¬¬ä¸€å±¤ï¼šæ™ºèƒ½åƒæ•¸è¨ˆç®— -->
            <div
              class="bg-gradient-to-br from-blue-500/20 to-indigo-500/20 backdrop-blur-sm rounded-2xl p-6 border border-blue-400/30">
              <h3 class="text-lg font-bold text-blue-300 mb-6">ç¬¬ä¸€å±¤ï¼šæ™ºèƒ½åƒæ•¸</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-blue-200">è¨ˆç®—æ™‚é–“</span>
                  <span class="text-lg font-bold text-white bg-blue-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.layerOne.calculationTime.toFixed(1) }}ms</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-blue-200">æŒ‡æ¨™æ•¸é‡</span>
                  <span class="text-lg font-bold text-white bg-blue-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.layerOne.indicatorCount }}é …</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-blue-200">è‡ªé©æ‡‰åƒæ•¸</span>
                  <span class="text-sm font-medium px-3 py-1 rounded-xl backdrop-blur-sm"
                    :class="sniperLayerStatus.layerOne.adaptiveParams ? 'text-green-300 bg-green-500/20' : 'text-gray-400 bg-gray-500/20'">
                    {{ sniperLayerStatus.layerOne.adaptiveParams ? 'âœ… å•Ÿç”¨' : 'âšª åœç”¨' }}
                  </span>
                </div>
              </div>
              <div class="mt-6 p-4 bg-blue-500/10 backdrop-blur-sm rounded-xl border border-blue-400/20">
                <div class="text-xs text-blue-200">
                  RSI: {{ sniperLayerStatus.layerOne.currentParams.rsi }} |
                  MACD: {{ sniperLayerStatus.layerOne.currentParams.macd_fast }}/{{
                    sniperLayerStatus.layerOne.currentParams.macd_slow }}
                </div>
              </div>
            </div>

            <!-- ç¬¬äºŒå±¤ï¼šå‹•æ…‹éæ¿¾ -->
            <div
              class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 backdrop-blur-sm rounded-2xl p-6 border border-green-400/30">
              <h3 class="text-lg font-bold text-green-300 mb-6">ç¬¬äºŒå±¤ï¼šå‹•æ…‹éæ¿¾</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-green-200">éæ¿¾æ™‚é–“</span>
                  <span class="text-lg font-bold text-white bg-green-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.layerTwo.filterTime.toFixed(1) }}ms</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-green-200">ä¿¡è™Ÿç”Ÿæˆ</span>
                  <span class="text-lg font-bold text-white bg-green-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.layerTwo.signalsGenerated }}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-green-200">ä¿¡è™Ÿéæ¿¾</span>
                  <span class="text-lg font-bold text-white bg-red-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.layerTwo.signalsFiltered }}</span>
                </div>
              </div>
              <div class="mt-6 p-4 bg-green-500/10 backdrop-blur-sm rounded-xl border border-green-400/20">
                <div class="text-xs text-green-200">
                  RSIç¯„åœ: {{ sniperLayerStatus.layerTwo.dynamicThresholds.rsi_low }}-{{
                    sniperLayerStatus.layerTwo.dynamicThresholds.rsi_high }} |
                  æœ€å°åŒ¯èš: {{ sniperLayerStatus.layerTwo.dynamicThresholds.confluence_min }}
                </div>
              </div>
            </div>

            <!-- å¸‚å ´ç‹€æ…‹åˆ†æ -->
            <div
              class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-sm rounded-2xl p-6 border border-purple-400/30">
              <h3 class="text-lg font-bold text-purple-300 mb-6">å¸‚å ´ç‹€æ…‹åˆ†æ</h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-purple-200">ç•¶å‰ç‹€æ…‹</span>
                  <span class="text-lg font-bold text-white bg-purple-500/20 px-3 py-1 rounded-xl">{{
                    sniperLayerStatus.marketRegime }}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-purple-200">ä¿¡è™Ÿé€šéç‡</span>
                  <span class="text-lg font-bold text-white bg-purple-500/20 px-3 py-1 rounded-xl">{{
                    (sniperLayerStatus.passRate * 100).toFixed(1) }}%</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-purple-200">ç¸½è™•ç†æ™‚é–“</span>
                  <span
                    class="text-lg font-bold text-white bg-gradient-to-r from-purple-500 to-pink-500 px-3 py-1 rounded-xl">{{
                      sniperLayerStatus.totalProcessingTime.toFixed(1) }}ms</span>
                </div>
              </div>
            </div>
          </div>

          <!-- æ´»èºæ¨™çš„è©³ç´°è¿½è¹¤ -->
          <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">ğŸ” æ´»èºæ¨™çš„è©³ç´°è¿½è¹¤</h3>
              <button @click="toggleActiveSymbolsDetail"
                class="text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200">
                {{ showActiveSymbolsDetail ? 'æ”¶èµ·è©³æƒ…' : 'å±•é–‹è©³æƒ…' }} ({{ sniperLayerStatus.activeSymbols }}å€‹)
              </button>
            </div>

            <!-- æ‘ºç–Šè©³ç´°å…§å®¹ -->
            <transition name="slide-down" enter-active-class="transition-all duration-300 ease-out"
              leave-active-class="transition-all duration-300 ease-in" enter-from-class="opacity-0 max-h-0"
              enter-to-class="opacity-100 max-h-screen" leave-from-class="opacity-100 max-h-screen"
              leave-to-class="opacity-0 max-h-0">
              <div v-show="showActiveSymbolsDetail" class="space-y-4 overflow-hidden">
                <div v-for="symbol in activeSymbolsDetails" :key="symbol.symbol"
                  class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">

                  <!-- æ¨™çš„æ¨™é¡Œ -->
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                      <div class="w-3 h-3 rounded-full" :class="{
                        'bg-green-500': symbol.status === 'active',
                        'bg-red-500': symbol.status === 'error',
                        'bg-yellow-500': symbol.status === 'processing'
                      }"></div>
                      <h4 class="font-bold text-gray-900 dark:text-white">{{ symbol.symbol }}</h4>
                      <span
                        class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 px-2 py-1 rounded-full">
                        {{ symbol.marketRegime }}
                      </span>
                    </div>
                    <span class="text-xs text-gray-500 dark:text-gray-400">{{ symbol.lastUpdate }}</span>
                  </div>

                  <!-- é›™å±¤æ¶æ§‹æŒ‡æ¨™ -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Layer 1 æŒ‡æ¨™ -->
                    <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-3">
                      <h5 class="font-medium text-blue-900 dark:text-blue-100 mb-2">Layer 1: æ™ºèƒ½åƒæ•¸</h5>
                      <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                          <span class="text-blue-700 dark:text-blue-300">è¨ˆç®—æ™‚é–“</span>
                          <span class="font-medium text-blue-900 dark:text-blue-100">{{ symbol.layerOne.calculationTime
                            }}ms</span>
                        </div>
                        <div class="flex justify-between">
                          <span class="text-blue-700 dark:text-blue-300">æŒ‡æ¨™æ•¸é‡</span>
                          <span class="font-medium text-blue-900 dark:text-blue-100">{{ symbol.layerOne.indicatorCount
                            }}é …</span>
                        </div>
                        <div class="flex justify-between">
                          <span class="text-blue-700 dark:text-blue-300">æ€§èƒ½è©•åˆ†</span>
                          <span class="font-medium text-blue-900 dark:text-blue-100">{{ symbol.layerOne.performanceScore
                            }}%</span>
                        </div>
                      </div>
                    </div>

                    <!-- Layer 2 æŒ‡æ¨™ -->
                    <div class="bg-green-50 dark:bg-green-900 rounded-lg p-3">
                      <h5 class="font-medium text-green-900 dark:text-green-100 mb-2">Layer 2: å‹•æ…‹éæ¿¾</h5>
                      <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                          <span class="text-green-700 dark:text-green-300">éæ¿¾æ™‚é–“</span>
                          <span class="font-medium text-green-900 dark:text-green-100">{{ symbol.layerTwo.filterTime
                            }}ms</span>
                        </div>
                        <div class="flex justify-between">
                          <span class="text-green-700 dark:text-green-300">é€šéç‡</span>
                          <span class="font-medium text-green-900 dark:text-green-100">{{ (symbol.layerTwo.passRate *
                            100).toFixed(1) }}%</span>
                        </div>
                        <div class="flex justify-between">
                          <span class="text-green-700 dark:text-green-300">éæ¿¾æ•ˆç‡</span>
                          <span class="font-medium text-green-900 dark:text-green-100">{{
                            symbol.layerTwo.filterEfficiency }}%</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- å‹•æ…‹é–¾å€¼é¡¯ç¤º -->
                  <div class="mt-3 p-2 bg-purple-50 dark:bg-purple-900 rounded">
                    <div class="text-xs text-purple-800 dark:text-purple-200">
                      <strong>å‹•æ…‹é–¾å€¼:</strong>
                      RSI {{ symbol.layerTwo.dynamicThresholds.rsi_low }}-{{ symbol.layerTwo.dynamicThresholds.rsi_high
                      }} |
                      æ³¢å‹•é–¾å€¼ {{ symbol.layerTwo.dynamicThresholds.volatility_threshold.toFixed(3) }} |
                      æœ€å°åŒ¯èš {{ symbol.layerTwo.dynamicThresholds.confluence_min }}
                    </div>
                  </div>

                  <!-- éŒ¯èª¤ä¿¡æ¯é¡¯ç¤º -->
                  <div v-if="symbol.error"
                    class="mt-3 p-2 bg-red-50 dark:bg-red-900 rounded border border-red-200 dark:border-red-700">
                    <div class="text-sm text-red-800 dark:text-red-200">
                      <strong>éŒ¯èª¤:</strong> {{ symbol.error }}
                    </div>
                  </div>
                </div>
              </div>
            </transition>
          </div>
        </div>
      </div>

      <!-- ğŸ§  æ™ºèƒ½ç³»çµ±è¨ºæ–·å€ -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-8">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">ğŸ§  æ™ºèƒ½ç³»çµ±è¨ºæ–·</h2>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <!-- ç³»çµ±å»ºè­° -->
            <div
              class="flex items-start space-x-3 p-4 bg-yellow-50 dark:bg-yellow-900 rounded-lg border border-yellow-200 dark:border-yellow-700">
              <div class="flex-shrink-0">
                <span class="text-yellow-600 dark:text-yellow-300">âš ï¸</span>
              </div>
              <div>
                <h4 class="font-medium text-yellow-800 dark:text-yellow-200">ç³»çµ±å»ºè­°</h4>
                <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                  ç•¶å‰å¸‚å ´ç‹€æ…‹ç‚º {{ sniperLayerStatus.marketRegime }}ï¼Œå»ºè­°é—œæ³¨ {{ sniperLayerStatus.activeSymbols }} å€‹æ´»èºæ¨™çš„çš„ä¿¡è™Ÿè®ŠåŒ–
                </p>
              </div>
            </div>

            <!-- æ€§èƒ½å„ªåŒ– -->
            <div
              class="flex items-start space-x-3 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg border border-blue-200 dark:border-blue-700">
              <div class="flex-shrink-0">
                <span class="text-blue-600 dark:text-blue-300">ğŸ’¡</span>
              </div>
              <div>
                <h4 class="font-medium text-blue-800 dark:text-blue-200">æ€§èƒ½å„ªåŒ–</h4>
                <p class="text-sm text-blue-700 dark:text-blue-300 mt-1">
                  ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹å¹³å‡è™•ç†æ™‚é–“ {{ sniperLayerStatus.totalProcessingTime.toFixed(1) }}msï¼Œè¡¨ç¾å„ªç•°ã€‚ä¿¡è™Ÿé€šéç‡ {{
                    (sniperLayerStatus.passRate * 100).toFixed(1) }}%
                </p>
              </div>
            </div>

            <!-- å¸‚å ´è¶¨å‹¢ -->
            <div
              class="flex items-start space-x-3 p-4 bg-green-50 dark:bg-green-900 rounded-lg border border-green-200 dark:border-green-700">
              <div class="flex-shrink-0">
                <span class="text-green-600 dark:text-green-300">ğŸ“ˆ</span>
              </div>
              <div>
                <h4 class="font-medium text-green-800 dark:text-green-200">å¸‚å ´æ©Ÿæœƒ</h4>
                <p class="text-sm text-green-700 dark:text-green-300 mt-1">
                  Phase 1ABC æ•´åˆéˆé‹è¡Œæ­£å¸¸ï¼ŒPhase 2+3 æ·±åº¦åˆ†æå·²æª¢æ¸¬åˆ° {{ sniperLayerStatus.activeSymbols }} å€‹æ½›åœ¨äº¤æ˜“æ©Ÿæœƒ
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- ğŸ¯ ç‹™æ“Šæ‰‹å‹•æ…‹é¢¨éšªç®¡ç†ç³»çµ± -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">ğŸ¯ ç‹™æ“Šæ‰‹å‹•æ…‹é¢¨éšªç®¡ç†ç³»çµ±</h2>
        </div>
        <div class="p-6">
          <RiskManagementDisplay />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import axios from 'axios'
import RiskManagementDisplay from '@/components/RiskManagementDisplay.vue'

// ğŸ¯ TypeScript ä»‹é¢å®šç¾©
interface SymbolDetail {
  symbol: string
  status: 'active' | 'error' | 'processing'
  marketRegime: string
  layerOne: {
    calculationTime: number
    indicatorCount: number
    adaptiveParams: boolean
    currentParams: {
      rsi: number
      macd_fast: number
      macd_slow: number
      bb_period: number
    }
    performanceScore: number
  }
  layerTwo: {
    filterTime: number
    signalsGenerated: number
    signalsFiltered: number
    passRate: number
    dynamicThresholds: {
      rsi_low: number
      rsi_high: number
      confluence_min: number
      volatility_threshold: number
    }
    filterEfficiency: number
  }
  error: string | null
  lastUpdate: string
}

// éŸ¿æ‡‰å¼æ•¸æ“š
const loading = ref(false)

// ğŸ¯ ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹éŸ¿æ‡‰å¼æ•¸æ“š
const sniperLayerStatus = ref({
  marketRegime: 'ANALYZING',
  activeSymbols: 0,
  passRate: 0,
  totalProcessingTime: 0,
  layerOne: {
    calculationTime: 0,
    indicatorCount: 0,
    adaptiveParams: false,
    currentParams: {
      rsi: 14,
      macd_fast: 12,
      macd_slow: 26
    }
  },
  layerTwo: {
    filterTime: 0,
    signalsGenerated: 0,
    signalsFiltered: 0,
    dynamicThresholds: {
      rsi_low: 30,
      rsi_high: 70,
      confluence_min: 2
    }
  }
})

// ğŸ¯ æ´»èºæ¨™çš„è©³ç´°è¿½è¹¤éŸ¿æ‡‰å¼æ•¸æ“š
const showActiveSymbolsDetail = ref(false)
const activeSymbolsDetails = ref<SymbolDetail[]>([])

// ğŸ¯ ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹æ–¹æ³•
const refreshSniperLayer = async () => {
  try {
    loading.value = true
    console.log('ğŸ¯ åˆ·æ–°ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹æ•¸æ“š...')

    // èª¿ç”¨ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹ API
    const response = await axios.get('/api/v1/scalping/sniper-unified-data-layer?symbols=BTCUSDT,ETHUSDT,ADAUSDT&timeframe=1h&force_refresh=true')

    if (response.data.status === 'success') {
      const results = response.data.results
      const successful = response.data.successful_symbols

      // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
      let totalCalcTime = 0
      let totalFilterTime = 0
      let totalSignalsGenerated = 0
      let totalSignalsFiltered = 0
      let totalProcessingTime = 0

      const resultValues = Object.values(results) as any[]
      resultValues.forEach((result: any) => {
        if (result.performance_metrics) {
          totalCalcTime += result.performance_metrics.layer_one_time || 0
          totalFilterTime += result.performance_metrics.layer_two_time || 0
          totalSignalsGenerated += result.performance_metrics.signals_quality?.generated || 0
          totalSignalsFiltered += result.performance_metrics.signals_quality?.filtered || 0
          totalProcessingTime += result.performance_metrics.total_processing_time || 0
        }
      })

      const firstResult = resultValues[0] as any

      // æ›´æ–°ç‹™æ“Šæ‰‹ç‹€æ…‹
      sniperLayerStatus.value = {
        marketRegime: firstResult?.market_regime?.toUpperCase() || 'ANALYZING',
        activeSymbols: successful,
        passRate: totalSignalsGenerated > 0 ? totalSignalsGenerated / (totalSignalsGenerated + totalSignalsFiltered) : 0,
        totalProcessingTime: Math.round(totalProcessingTime * 1000) / successful || 0,
        layerOne: {
          calculationTime: Math.round(totalCalcTime * 1000) / successful || 0,
          indicatorCount: firstResult?.layer_one?.indicators_count || 14,
          adaptiveParams: true,
          currentParams: {
            rsi: firstResult?.layer_one?.config_used?.rsi_length || 14,
            macd_fast: firstResult?.layer_one?.config_used?.macd_fast || 12,
            macd_slow: firstResult?.layer_one?.config_used?.macd_slow || 26
          }
        },
        layerTwo: {
          filterTime: Math.round(totalFilterTime * 1000) / successful || 0,
          signalsGenerated: totalSignalsGenerated,
          signalsFiltered: totalSignalsFiltered,
          dynamicThresholds: {
            rsi_low: firstResult?.layer_two?.filter_results?.dynamic_filter_config?.rsi_oversold || 30,
            rsi_high: firstResult?.layer_two?.filter_results?.dynamic_filter_config?.rsi_overbought || 70,
            confluence_min: firstResult?.layer_two?.filter_results?.dynamic_filter_config?.confluence_min_count || 2
          }
        }
      }

      // ğŸ” æ§‹å»ºæ´»èºæ¨™çš„è©³ç´°æ•¸æ“š
      activeSymbolsDetails.value = Object.entries(results).map(([symbol, result]: [string, any]) => ({
        symbol,
        status: result.success === false ? 'error' : 'active',
        marketRegime: result.market_regime || 'unknown',
        layerOne: {
          calculationTime: Math.round((result.performance_metrics?.layer_one_time || 0) * 1000),
          indicatorCount: result.layer_one?.indicators_count || 14,
          adaptiveParams: result.layer_one?.adaptive_params_active || false,
          currentParams: {
            rsi: result.layer_one?.config_used?.rsi_length || 14,
            macd_fast: result.layer_one?.config_used?.macd_fast || 12,
            macd_slow: result.layer_one?.config_used?.macd_slow || 26,
            bb_period: result.layer_one?.config_used?.bb_period || 20
          },
          performanceScore: Math.round((result.layer_one?.performance_score || 0) * 100)
        },
        layerTwo: {
          filterTime: Math.round((result.performance_metrics?.layer_two_time || 0) * 1000),
          signalsGenerated: result.performance_metrics?.signals_quality?.generated || 0,
          signalsFiltered: result.performance_metrics?.signals_quality?.filtered || 0,
          passRate: result.performance_metrics?.signals_quality?.generated > 0
            ? result.performance_metrics.signals_quality.generated /
            (result.performance_metrics.signals_quality.generated + result.performance_metrics.signals_quality.filtered)
            : 0,
          dynamicThresholds: {
            rsi_low: result.layer_two?.filter_results?.dynamic_filter_config?.rsi_oversold || 30,
            rsi_high: result.layer_two?.filter_results?.dynamic_filter_config?.rsi_overbought || 70,
            confluence_min: result.layer_two?.filter_results?.dynamic_filter_config?.confluence_min_count || 2,
            volatility_threshold: result.layer_two?.filter_results?.dynamic_filter_config?.volatility_threshold || 0.02
          },
          filterEfficiency: Math.round((result.layer_two?.filter_efficiency || 0) * 100)
        },
        error: result.success === false ? result.error : null,
        lastUpdate: new Date().toLocaleTimeString()
      }))

      console.log('âœ… ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹æ•¸æ“šæ›´æ–°å®Œæˆ:', sniperLayerStatus.value)
      console.log('ğŸ¯ æ´»èºæ¨™çš„è©³ç´°æ•¸æ“š:', activeSymbolsDetails.value)
    }
  } catch (error) {
    console.error('âŒ ç‹™æ“Šæ‰‹é›™å±¤æ¶æ§‹æ•¸æ“šåˆ·æ–°å¤±æ•—:', error)
  } finally {
    loading.value = false
  }
}

// ğŸ¯ åˆ‡æ›æ´»èºæ¨™çš„è©³ç´°é¡¯ç¤º
const toggleActiveSymbolsDetail = () => {
  showActiveSymbolsDetail.value = !showActiveSymbolsDetail.value
  console.log('ğŸ” åˆ‡æ›æ´»èºæ¨™çš„è©³ç´°é¡¯ç¤º:', showActiveSymbolsDetail.value)
}

// ç”Ÿå‘½é€±æœŸ
onMounted(() => {
  refreshSniperLayer() // åˆå§‹è¼‰å…¥ç‹™æ“Šæ‰‹æ•¸æ“š
})
</script>

<style scoped>
.slide-down-enter-active,
.slide-down-leave-active {
  transition: all 0.3s ease;
}

.slide-down-enter-from {
  opacity: 0;
  max-height: 0;
}

.slide-down-enter-to {
  opacity: 1;
  max-height: 1000px;
}

.slide-down-leave-from {
  opacity: 1;
  max-height: 1000px;
}

.slide-down-leave-to {
  opacity: 0;
  max-height: 0;
}
</style>
